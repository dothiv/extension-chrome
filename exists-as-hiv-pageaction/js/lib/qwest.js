/*
    qwest, ajax library with promises and XHR2 support

    Version     : 0.3.2
    Author      : Aur√©lien Delogu (dev@dreamysource.fr)
    Homepage    : https://github.com/pyrsmk/qwest
    License     : MIT
*/this.qwest=function(){var qwest=function(method,url,data,options,before){data=data||null,options=options||{};var win=window,typeSupported=!1,xhr=win.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),version2=xhr.responseType==="",async=options.async===undefined?!0:!!options.async,cache=!!options.cache,type=options.type?options.type.toLowerCase():"json",user=options.user||"",password=options.password||"",headers={"X-Requested-With":"XMLHttpRequest"},accepts={xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},vars="",i,parseError="parseError",serialized,success_stack=[],error_stack=[],complete_stack=[],response,success,error,func,promises={success:function(e){return async?success_stack.push(e):success&&e.apply(xhr,[response]),promises},error:function(e){return async?error_stack.push(e):error&&e.apply(xhr,[response]),promises},complete:function(e){return async?complete_stack.push(e):e.apply(xhr),promises}},handleResponse=function(){var i;try{if(xhr.status!=200)throw xhr.status+" ("+xhr.statusText+")";var responseText=xhr.responseText,responseXML="responseXML";if(type=="text"||type=="html")response=responseText;else if(typeSupported&&xhr.response!==undefined)response=xhr.response;else switch(type){case"json":try{win.JSON?response=win.JSON.parse(responseText):response=eval("("+responseText+")")}catch(e){throw"Error while parsing JSON body"}break;case"js":response=eval(responseText);break;case"xml":if(!xhr[responseXML]||xhr[responseXML][parseError]&&xhr[responseXML][parseError].errorCode&&xhr[responseXML][parseError].reason)throw"Error while parsing XML body";response=xhr[responseXML];break;default:throw"Unsupported "+type+" type"}success=!0;if(async)for(i=0;func=success_stack[i];++i)func.apply(xhr,[response])}catch(e){error=!0,response="Request to '"+url+"' aborted: "+e;if(async)for(i=0;func=error_stack[i];++i)func.apply(xhr,[response])}if(async)for(i=0;func=complete_stack[i];++i)func.apply(xhr)};type&&version2&&(xhr.responseType=type,typeSupported=xhr.responseType==type);if(data instanceof ArrayBuffer||data instanceof Blob||data instanceof Document||data instanceof FormData)method=="GET"&&(data=null);else{var values=[],enc=encodeURIComponent;for(i in data)values.push(enc(i)+"="+enc(data[i]));data=values.join("&"),serialized=!0}method=="GET"&&(vars+=data),cache||(vars&&(vars+="&"),vars+="t="+Date.now()),vars&&(url+=(/\?/.test(url)?"&":"?")+vars),xhr.open(method,url,async,user,password),version2?xhr.onload=handleResponse:xhr.onreadystatechange=function(){xhr.readyState==4&&handleResponse()},serialized&&method=="POST"&&(headers["Content-Type"]="application/x-www-form-urlencoded"),headers.Accept=accepts[type];for(i in headers)xhr.setRequestHeader(i,headers[i]);return before&&before.apply(xhr),xhr.send(method=="POST"?data:null),promises};return{get:function(e,t,n,r){return qwest("GET",e,t,n,r)},post:function(e,t,n,r){return qwest("POST",e,t,n,r)}}}();